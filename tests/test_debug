const assert = require('assert');
const getOpenPositionTitles = require('../getOpenPositionTitles');
const { setupBrowser } = require('../setupBrowser');

(async () => {
  let browser, page;

  try {
    // Debugging output
    console.log('Setting up browser...');
    ({ browser, page } = await setupBrowser());
    console.log('Browser setup complete.');

    // Navigate directly using the page object
    console.log('Navigating to https://www.rdbrck.com/careers...');
    await page.goto('https://www.rdbrck.com/careers');
    console.log('Navigation complete.');

    // Use the getOpenPositionTitles method to get a list of open positions
    console.log('Getting open position titles...');
    const openPositionTitles = await getOpenPositionTitles(page);
    console.log('Open position titles:', openPositionTitles);

    // Validation: Check if "Lead QA Automation Developer" is in the list of open positions
    const positionToFind = 'Lead QA Automation Developer';
    assert(openPositionTitles.includes(positionToFind), `${positionToFind} - does not appear in the list`);

    console.log(`${positionToFind} - found in the list`);

    // If the position is found = test passed
    console.log('Test Passed!');
  } catch (error) {
    console.error('Error during test:', error);
  } finally {
    // Debugging output
    console.log('Closing browser...');
    await browser.close();
    console.log('Browser closed.');
  }
})();
